# Implementation Plan

- [x] 1. 设置项目基础结构和类型定义

  - 创建必要的目录结构和 TypeScript 接口
  - 定义 API 数据模型和前端状态模型
  - 配置 shadcn/ui 组件和主题系统
  - _Requirements: 1.1, 2.1, 3.1_

- [x] 2. 实现核心服务层
- [x] 2.1 创建聊天服务和 SSE 处理

  - 实现 ChatService 类处理 API 请求
  - 编写 SSE 流数据解析逻辑
  - 创建错误处理和重试机制
  - _Requirements: 1.2, 1.3, 4.6_

- [x] 2.2 实现主题服务

  - 集成 next-themes 主题管理
  - 实现主题切换和持久化逻辑
  - 创建主题相关的工具函数
  - _Requirements: 3.1, 3.2, 3.4_

- [x] 3. 开发基础 UI 组件
- [x] 3.1 创建主题切换组件

  - 实现 ThemeToggle 组件
  - 添加主题切换动画效果
  - 编写组件单元测试
  - _Requirements: 3.2, 3.3_

- [x] 3.2 创建消息相关组件

  - 实现 MessageItem 组件显示用户和助手消息
  - 创建 ToolCallDisplay 组件显示工具调用状态
  - 添加消息类型区分和样式
  - _Requirements: 1.1, 1.4, 4.1, 4.2_

- [x] 3.3 创建输入组件

  - 实现 ChatInput 组件处理用户输入
  - 添加发送按钮状态管理
  - 实现键盘事件处理（Enter 发送）
  - _Requirements: 1.1, 2.3_

- [-] 4. 实现核心聊天功能
- [x] 4.1 创建聊天状态管理

  - 实现 useChat Hook 管理聊天状态
  - 创建消息和工具调用状态管理逻辑
  - 添加 SSE 连接状态管理
  - _Requirements: 1.2, 1.7, 5.1, 5.5_

- [x] 4.2 实现消息列表组件

  - 创建 MessageList 组件渲染消息历史
  - 实现自动滚动到最新消息
  - 添加工具调用状态显示
  - _Requirements: 1.1, 2.5, 4.4_

- [x] 4.3 实现聊天容器组件

  - 创建 ChatContainer 组件整合所有子组件
  - 实现 SSE 事件处理和状态更新
  - 添加错误处理和重试逻辑
  - _Requirements: 1.2, 1.3, 1.6, 4.6, 5.2, 5.3_

- [ ] 5. 实现流式数据处理
- [x] 5.1 创建 SSE 数据解析器

  - 实现 SSE 事件解析函数
  - 处理 tool_event 和 chat_event 类型
  - 添加数据验证和错误处理
  - _Requirements: 1.3, 1.4, 1.5, 5.1_

- [x] 5.2 实现工具调用状态显示

  - 根据工具类型显示不同的状态文本
  - 实现 current_time 工具状态："正在获取当前时间" → "获取到当前时间为 xxx"
  - 实现 tavily_search 工具状态："正在搜索 xxx" → "搜索到 x 个结果，正在生成回答"
  - _Requirements: 1.2, 1.3, 1.4, 4.1, 4.2_

- [x] 5.3 实现流式内容更新

  - 处理 chat_event 流式内容显示
  - 实现打字机效果的内容更新
  - 添加流式状态指示器
  - _Requirements: 1.6, 2.4, 4.2_

- [ ] 6. 创建聊天页面
- [x] 6.1 实现聊天页面组件

  - 创建 /chat 页面路由
  - 整合所有聊天功能组件
  - 添加页面级错误边界
  - _Requirements: 1.1, 2.1, 4.6_

- [ ] 6.2 实现响应式布局

  - 添加移动端适配样式
  - 实现响应式设计布局
  - 测试不同屏幕尺寸的显示效果
  - _Requirements: 2.6_

- [ ] 7. 完善用户体验
- [x] 7.1 添加加载动画和骨架屏

  - 实现消息发送时的加载状态
  - 添加工具调用时的动画效果
  - 使用 shadcn/ui Skeleton 组件
  - _Requirements: 2.4, 4.3_

- [ ] 7.2 实现错误处理和重试

  - 添加网络错误提示
  - 实现连接失败重试机制
  - 创建用户友好的错误信息显示
  - _Requirements: 4.6, 5.3, 5.6_

- [ ] 8. 集成测试和优化
- [ ] 8.1 编写组件单元测试

  - 为所有核心组件编写测试用例
  - 测试用户交互和状态变化
  - 模拟 SSE 数据流测试
  - _Requirements: 所有需求的验证_

- [ ] 8.2 实现端到端测试

  - 编写完整对话流程的 E2E 测试
  - 测试主题切换功能
  - 测试错误处理和恢复
  - _Requirements: 所有需求的集成验证_

- [ ] 8.3 性能优化和最终调试
  - 优化组件渲染性能
  - 实现内存泄漏防护
  - 调试和修复发现的问题
  - _Requirements: 2.5, 2.6_
